{% extends "management/index_team.html" %}
{% load staticfiles %}
{% load i18n %}

<!-- Content -->
{% block header %}
    
{% endblock %}

{% block extrascript %}
<link rel="stylesheet" href="{% static 'css/chart.css' %}" />
<style>
	table{
		margin-top: 20px;
	}

	ul{
		padding-left: 0px;
	}
	.btn-success{
		margin-top: 20px;
	}
	.nav-tabs{
		margin-bottom: 20px;
	}
	#save_depth_chart {
		float:right;
		margin-top: 20px;
	}
	#field{
		background-image: url("{% static 'diamond.png' %}");
		height: 731px;
		margin-bottom:20px;
	}
	.ui-widget-header.position-danger{
		background: linear-gradient(#D10015, #FB6978);;
		border: none;
	}
	#edit{
		margin: 0px 2px 0px 0px;
	}
</style>

<script>
	$( document ).ajaxComplete(function() {
    	$('#editPlayerModal #id_team').val("{{teams.0.pk}}");
    	$('#save_depth_chart').click(function() {
    		$('#submitButton').click();
    	});
    	$('.dropElement').each(function() {
    		if ($(this).text() == "Left Field" ||
    			$(this).text() == "Center Field" ||
    			$(this).text() == "Right Field" ||
    			$(this).text() == "Shortstop" ||
    			$(this).text() == "Second Base" ||
    			$(this).text() == "Third Base" ||
    			$(this).text() == "Starting Pitcher" ||
    			$(this).text() == "First Base" ||
    			$(this).text() == "Relief Pitcher" ||
    			$(this).text() == "Catcher" ||
    			$(this).text() == "Designated Hitter") {
    				$(this).parent().addClass("position-danger");
    		};
    	});
    	$('.selectpicker').selectpicker();
	});
	$( document ).ajaxComplete(function() {
		$( ".draggable" ).draggable({ snap: ".ui-widget-header", helper: "clone" });
		$( ".droppable" ).droppable({ 
			drop: function( event, ui ) {
        		$( this ).find( "p" ).remove();
        		$( "<p id='dropElement'></p>" ).text( ui.draggable.text() ).appendTo( this );
        		var position_id = $(this).attr("id") ;
        		var player = ui.helper.context.innerText;
        		$('#editPlayerModal #id_' + position_id).val(player);
        		$(this).removeClass("position-danger");
            }
        });
	});

</script>
{% endblock %}

{% block content %}
<div class="container">
	<ul class="nav nav-tabs">
		<li class="active"><a href="#home" data-toggle="tab">Home</a></li>
		<li class="dropdown">
			<a class="dropdown-toggle" data-toggle="dropdown" href="#">
			Players <span class="caret"></span>
			</a>
			<ul class="dropdown-menu">
				<li><a href="#roster" data-toggle="tab" id="player_roster">Roster</a></li>
				<li><a href="#depthchart" data-toggle="tab" id="depth_chart">Depth Chart</a></li>
			</ul>
		</li>
		<li><a href="#schedule" data-toggle="tab" id="game_schedule">Schedule</a></li>
		<li><a href="#stats" data-toggle="tab" id="player_stats">Statistics</a></li>
		<div class="btn-group pull-right">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">{{year}} <span class="caret"></span></button>
		<ul class="dropdown-menu" role="menu">
			{% for s in seasons %}
				<li><a href="{% url 'season_detail' username=user name=name year=s.year %}">{{s.year}}</a></li>
			{% endfor %}
		</ul>
		</div>
	</ul>
    <div id='content' class="tab-content">

		<div class="tab-pane active" id="home">

		</div>

		<div class="tab-pane" id="roster">
			<button type="button" class="btn btn-success" id="add_new_player"><span class="glyphicon glyphicon-plus"></span> Add Player</button>
			<table class="table table-bordered table-striped" id="player_table"></table>
		</div>

		<div class="tab-pane" id="depthchart"></div>

		<div class="tab-pane" id="schedule">
			<button type="button" class="btn btn-success"><span class="glyphicon glyphicon-plus"></span> Add Game</button>
			<table class="table table-bordered table-striped" id="game_table"></table>
		</div>

		<div class="tab-pane" id="stats"></div>
			
    </div>   

    <!-- Jake's Fake Model-->
    <div id="editPlayerModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    	<div class="modal-dialog">
    		<div class="modal-content">
    			<div class="modal-header">
    				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    				<h3 id="myModalLabel1">Edit Position</h3>
    			</div>
    			<div class="modal-body">
    				<form role="form" id="form" action="{% url 'season_detail' username=user name=name year=year %}" method="post">
    					{% csrf_token %}
    					<input type="hidden" class="form-group" id="id_pk" name="pk" value="change_this">
    					<div class="form-group">
    						{{ form }}
    					</div>

    					<div class="modal-footer">
    						<button type="submit" class="btn btn-danger pull-left" name="delete" id="deleteButton">Delete</button>
    						<button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
    						<button type="submit" class="btn btn-primary" name="update_modal" id="submitButton">Save</button>
    					</div>
    				</form>
    			</div>
    		</div>
    	</div>
    </div>
</div>
<script>
$('#player_roster').click(function (e) {
	e.preventDefault()
	$(this).tab('show');
    $.ajax({
        url : "{% url 'player_list' username=user name=name year=year %}",
        success: function(data){
            $('#player_table').html(data);
        }
    });
    $('.dropdown-toggle').dropdown("toggle");
})

$('#game_schedule').click(function (e) {
	e.preventDefault()
	$(this).tab('show');
    $.ajax({
        url : "{% url 'game_list' username=user name=name year=year %}",
        success: function(data){
            $('#game_table').html(data);
        }
    });
    $('.dropdown-toggle').dropdown("toggle");
})

$('#player_stats').click(function (e) {
	e.preventDefault()
	$(this).tab('show');
    $.ajax({
        url : "{% url 'player_stats' username=user name=name year=year %}",
        success: function(data){
            $('#stats').html(data);
        }
    });
    $('.dropdown-toggle').dropdown("toggle");
})

$('#depth_chart').click(function (e) {
	e.preventDefault()
	$(this).tab('show');
    $.ajax({
        url : "{% url 'depth_chart' username=user name=name year=year %}",
        success: function(data){
            $('#depthchart').html(data);
        }
    });
    $('.dropdown-toggle').dropdown("toggle");
})
</script>

{% endblock %}